<!DOCTYPE html>
<html>
{% if user.is_authenticated %}
Hi {{ user.username }}!
        <head>
            <meta charset="utf-8">
            <title>My Job Applications</title>
            {% load static %}
            <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
            <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">
            <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
            <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script> 
        </head>
        <body>
            <ul>
                {% for stage in latest_stage_list %}
                    <li><a>{{ stage.stage_title }}</a>
                        <ul id = "{{ stage.stage_title }}" class="connectedSortable">
                            {% for posting in stage.ordered_posting_set %}
                                <li  id = "{{ posting.job_title }}" class="ui-state-default">{{ posting.job_title}}</a></li>
                             {% endfor %}
                            <li id="entry_4" class="ui-state-default">{{ stage.stage_title }}</li>
                            <li id="entry_5" class="ui-state-default">Entry #5</li>
                            <li id="entry_6" class="ui-state-default">Entry #6</li>
                        </ul>  
                    </li>
                {% endfor %}
            </ul>
              
        <p><a href="{% url 'logout' %}">Log Out</a></p>
    
     </body>
{% else %}
<p>You are not logged in</p>
<a href="/accounts/login/">Log In</a>
{% endif %}
</html>

{% block extrajavascript %}

<!-- required for CSRF cookie parsing //-->
<script src="{% static 'js/jquery-sortable.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script>
// get the Django CSRF Cookie
$(function() {

// Make our ordered list with a class of example sortable.
// onDrop (reorder item) make a JSON representation of the list and POST the JSON to the current page
var group = $("#Applied, #Assessment, #Interview" ).sortable({
        connectWith: '.connectedSortable',
        delay: 500,
        update: function () {
            var data = $("#Applied" ).sortable("serialize");
            var jsonString = JSON.stringify(data);
            document.write(jsonString);
            $.ajax({
                        type: "POST",
                        data: jsonString,
                        url: "index.html"
                    });
        },
});
}).disableSelection();
</script>

{% endblock %}     